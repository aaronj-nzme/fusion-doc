

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Including Static Features Outside of Fusion &mdash; Fusion-Doc 1.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Best Practices" href="bp.html" />
    <link rel="prev" title="Locally Generated Webpack Stats File" href="local-webpack-states-file.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Fusion-Doc
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Components:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="output.html">Creating and Using Output Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="feature.html">Creating a Feature Component</a></li>
<li class="toctree-l1"><a class="reference internal" href="layout.html">Creating a Layout Component</a></li>
<li class="toctree-l1"><a class="reference internal" href="chain.html">Creating a Chain Component</a></li>
<li class="toctree-l1"><a class="reference internal" href="event-handling.html">Event Handling and Interaction</a></li>
</ul>
<p class="caption"><span class="caption-text">Data:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="content-source.html">Defining a Content Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment.html">Using Environment Variables and “Secrets”</a></li>
<li class="toctree-l1"><a class="reference internal" href="consumer-hoc.html">Using the Consumer Higher-Order Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="fetching-content.html">Fetching Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuring-content.html">Dynamically Configuring Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="content-filtering.html">Content Filtering in Fusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="site-properties.html">Using Site Properties</a></li>
</ul>
<p class="caption"><span class="caption-text">General:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Folder.html">Examining the Feature Pack</a></li>
<li class="toctree-l1"><a class="reference internal" href="style.html">Adding Styling to Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom-fields.html">Adding Custom Fields to Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="display-properties.html">Working with Display Properties</a></li>
<li class="toctree-l1"><a class="reference internal" href="isomorphic-server-spa.html">Isomorphic vs. Server vs. SPA rendering</a></li>
<li class="toctree-l1"><a class="reference internal" href="messga-between-components.html">Messaging Between Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom-error-page.html">Using Custom Error Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="return-non-html-content-type.html">Creating a Web API Returning a Non-HTML Content Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="service-work.html">Using Service Workers with Fusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="local-webpack-states-file.html">Locally Generated Webpack Stats File</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Including Static Features Outside of Fusion</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#create-an-output-type">Create an Output Type</a></li>
<li class="toctree-l2"><a class="reference internal" href="#replace-relative-links-in-css">Replace relative links in CSS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#replace-relative-links-in-html">Replace relative links in HTML</a></li>
<li class="toctree-l2"><a class="reference internal" href="#configure-the-fragment-in-pagebuilder">Configure the fragment in PageBuilder</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Best Practices:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="bp.html">Best Practices</a></li>
</ul>
<p class="caption"><span class="caption-text">Hooks:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hooks-configuring-content.html">Dynamically Configuring Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="hooks-fetching-content.html">Fetching Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="hooks-event-handling.html">Event Handling and Interaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="hooks.html">React Hooks</a></li>
</ul>
<p class="caption"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api-output.html">Output Type API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-feature.html">Feature API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-layout.html">Layout API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-chain.html">Chain API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-custom-fields.html">Custom Fields API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-consumer.html">Consumer API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-context.html">Context Component API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-content.html">Content Component API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-static.html">Static Component API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-content-source.html">Content Source API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-plugins.html">Plugins API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-local-development-mock.html">Local Mocks API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-site-properties.html">Site Properties API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-fusion-http.html">Fusion HTTP API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Fusion-Doc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Including Static Features Outside of Fusion</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/static-features-outside-of-fusion.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="including-static-features-outside-of-fusion">
<h1>Including Static Features Outside of Fusion<a class="headerlink" href="#including-static-features-outside-of-fusion" title="Permalink to this headline">¶</a></h1>
<p>In certain cases you may need to include a Fusion component on a non-Fusion rendered site or page. A common use case for including a Fusion component in non-Fusion environments may include rendering a shared header and/or footer in a different site or application that should have similar features as your Fusion application. The other application will, presumably, have its own rendering engine that may not be written in React or even in JavaScript (gasp!). Instead of trying to render the React component’s source directly in this application, we will instead use a work-around that allows Fusion to render the relevant HTML fragment from an API endpoint, and then the non-Fusion application can fetch that HTML and include it directly in its server side payload.</p>
<p>It’s worth noting that this method of generating an HTML fragment to be included elsewhere won’t support components that need client-side rendering or interactivity - only components that can be rendered statically on the server. So if your shared component won’t work without client-side JavaScript, it’s probably not a good candidate for this implementation.</p>
<p>In this example, we’ll assume you want to use a shared <code class="docutils literal notranslate"><span class="pre">global/header.jsx</span></code> feature from your Fusion app in a different non-Fusion app. We won’t define that feature in our code here since it’s outside the scope of the article, but we’ll assume it’s a regular Fusion component that is marked as <code class="docutils literal notranslate"><span class="pre">.static</span> <span class="pre">=</span> <span class="pre">true</span></code>.</p>
<div class="section" id="create-an-output-type">
<h2>Create an Output Type<a class="headerlink" href="#create-an-output-type" title="Permalink to this headline">¶</a></h2>
<p>Since we are rendering an HTML fragment, rather than an entire HTML webpage, we need a custom Output Type for this purpose. We’ll create a new Output Type named <code class="docutils literal notranslate"><span class="pre">ServerSideInclude</span></code> for this purpose, but in practice you can name it anything you’d like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span>  <span class="o">/</span><span class="n">components</span><span class="o">/</span><span class="n">output</span><span class="o">-</span><span class="n">types</span><span class="o">/</span><span class="n">server</span><span class="o">-</span><span class="n">side</span><span class="o">-</span><span class="n">include</span><span class="o">.</span><span class="n">jsx</span>  <span class="o">*/</span>

<span class="kn">import</span> <span class="nn">React</span><span class="o">,</span> <span class="p">{</span> <span class="n">Fragment</span> <span class="p">}</span> <span class="kn">from</span> <span class="s1">&#39;react&#39;</span>
<span class="kn">import</span> <span class="nn">PropTypes</span> <span class="kn">from</span> <span class="s1">&#39;prop-types&#39;</span>

<span class="n">const</span> <span class="n">ServerSideInclude</span> <span class="o">=</span> <span class="p">({</span> <span class="n">children</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="k">return</span> <span class="p">(</span>
    <span class="o">&lt;</span><span class="n">Fragment</span><span class="o">&gt;</span>
      <span class="p">{</span><span class="n">children</span><span class="p">}</span>
    <span class="o">&lt;/</span><span class="n">Fragment</span><span class="o">&gt;</span>
  <span class="p">)</span>
<span class="p">}</span>

<span class="n">ServerSideInclude</span><span class="o">.</span><span class="n">propTypes</span> <span class="o">=</span> <span class="p">{</span>
  <span class="n">children</span><span class="p">:</span> <span class="n">PropTypes</span><span class="o">.</span><span class="n">any</span>
<span class="p">}</span>

<span class="n">ServerSideInclude</span><span class="o">.</span><span class="n">contentType</span> <span class="o">=</span> <span class="s1">&#39;text/html&#39;</span>

<span class="n">export</span> <span class="n">default</span> <span class="n">ServerSideInclude</span>
</pre></div>
</div>
<p>This is the simplest possible Output Type we could create - all we are doing is rendering the children of this component into a Fragment.</p>
</div>
<div class="section" id="replace-relative-links-in-css">
<h2>Replace relative links in CSS<a class="headerlink" href="#replace-relative-links-in-css" title="Permalink to this headline">¶</a></h2>
<p>While the above Output Type will work, it won’t have any of the CSS to style the component. In a normal Output Type we could include the CSS with our typical <code class="docutils literal notranslate"><span class="pre">&lt;CssLinks</span> <span class="pre">/&gt;</span></code> tag; however, that won’t work for 2 reasons:</p>
<ul class="simple">
<li>we don’t want to add an external <code class="docutils literal notranslate"><span class="pre">&lt;link&gt;</span></code> tag to our fragment, we want the CSS defined in a <code class="docutils literal notranslate"><span class="pre">&lt;style&gt;</span></code> tag, but more importantly</li>
<li>we need to make all references to relative links in the CSS absolute paths, since this code will be used on a different domain than the domain the assets are served from.</li>
</ul>
<p>So let’s make use of some custom logic and a <code class="docutils literal notranslate"><span class="pre">&lt;Resource&gt;</span></code> tag to get the CSS code and transform it into a <code class="docutils literal notranslate"><span class="pre">&lt;style&gt;</span></code> tag with absolute-path URLs directly:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/*  /components/output-types/server-side-include.jsx  */

import React, { Fragment } from &#39;react&#39;
import PropTypes from &#39;prop-types&#39;

// Define the rootDomain of the site to be used later. In a real use case, you may have logic here to get this from an environment variable or elsewhere instead of hardcoding it
const rootDomain = &#39;https://my-website-domain.com&#39;

const ServerSideInclude = ({ children, Resource, contextPath }) =&gt; {
  return (
    &lt;Fragment&gt;
      {/* Using a Resource tag to import the raw styles as `data` */}
      &lt;Resource path={`resources/styles.css`}&gt;
        {({ data }) =&gt; {
          if (!data) return null

          {/* Using the string `replace` function to replace any CSS URLs with  */}
          const css = data.replace(/url\((\.[^\s&lt;&gt;{}|\\^~)&#39;&quot;`]+)\)/g, (_, uri) =&gt; {
            // replace any url that starts with a `..`
            const trimmedUri = uri ? uri.replace(/\.\.\//g, &#39;&#39;) : uri
            return `url(${rootDomain}${contextPath}/resources/${trimmedUri})`
          })
          return &lt;style dangerouslySetInnerHTML={{__html: css}} /&gt;
        }}
      &lt;/Resource&gt;
      }
      {children}
    &lt;/Fragment&gt;
  )
}

ServerSideInclude.propTypes = {
  children: PropTypes.any,
  Resource: PropTypes.func,
  contextPath: PropTypes.string
}

ServerSideInclude.contentType = &#39;text/html&#39;

export default ServerSideInclude
</pre></div>
</div>
<p>In the code above, we’ve used a Regular Expression to replace relative links in our CSS with absolute ones, which should ensure our CSS works anywhere this HTML fragment is rendered. This function may need to be changed to work with your code, but the idea is the same - make relative URLs into absolute ones.</p>
</div>
<div class="section" id="replace-relative-links-in-html">
<h2>Replace relative links in HTML<a class="headerlink" href="#replace-relative-links-in-html" title="Permalink to this headline">¶</a></h2>
<p>We’re almost done with this Output Type - but first, we need to do the same thing for our HTML that we did for our CSS. It’s possible that in the HTML fragment we’re rendering relative links within the page (e.g. to an image or other static asset), which we don’t want to do. We need to update these to be absolute URLs to our Fusion domain as well. In order to fix this, we will use the handy <code class="docutils literal notranslate"><span class="pre">transform</span></code> object that is available on Output Types. The <code class="docutils literal notranslate"><span class="pre">transform</span></code> object is a post-render hook that allows us to add a method that takes in the fully-rendered HTML of this output type, and transform it somehow into a different Output Type. The name of the method we define in the <code class="docutils literal notranslate"><span class="pre">transform</span></code> object will become the name of the Output Type we want to use later.</p>
<p>Here’s how to use it:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/*  /components/output-types/server-side-include.jsx  */

import React, { Fragment } from &#39;react&#39;
import PropTypes from &#39;prop-types&#39;

const rootDomain = &#39;https://my-website-domain.com&#39;

// Add a method to replace relative `href` and `src` URLs with absolute versions of the URL
const relativeToAbsolutePaths = (html) =&gt; html
  .replace(
    /(href|src)=([&quot;&#39;])(?!(https?:)?\/\/)(.*?)\2/g,
    `$1=$2${rootDomain}$4$2`
  )

// Output type definition stays the same...
...

// Add our transform method to replace relative links with absolute ones
ServerSideInclude.transform = {
  ssi ({ data }) {
    return {
      contentType: &#39;text/html&#39;,
      data: relativeToAbsolutePaths(data)
    }
  }
}

export default ServerSideInclude
</pre></div>
</div>
<p>In our <code class="docutils literal notranslate"><span class="pre">transform</span></code> object we’ve defined an <code class="docutils literal notranslate"><span class="pre">ssi()</span></code> method which is responsible for returning the proper <code class="docutils literal notranslate"><span class="pre">contentType</span></code> (<code class="docutils literal notranslate"><span class="pre">text/html</span></code> in this case) and the HTML with updated paths. Now, when we use the <code class="docutils literal notranslate"><span class="pre">ssi</span></code> Output Type to render a component (or set of components) we will get the HTML fragment back with absolute path URLs.</p>
</div>
<div class="section" id="configure-the-fragment-in-pagebuilder">
<h2>Configure the fragment in PageBuilder<a class="headerlink" href="#configure-the-fragment-in-pagebuilder" title="Permalink to this headline">¶</a></h2>
<p>Now that we have an Output Type that is configured to render HTML fragments with absolute URLs, all the work we need to do should be in the PageBuilder Editor. First, we’ll want to create a page in PageBuilder with a descriptive URL. Since we’re rendering a header, let’s make the path to this page <code class="docutils literal notranslate"><span class="pre">/ssi-header</span></code>. Next, in the editor view for this page, we’ll want to add our <code class="docutils literal notranslate"><span class="pre">Global</span> <span class="pre">Header</span></code> feature to the page, which is the component we are actually trying to share. When we publish this page and view it at the proper URL (which should be <code class="docutils literal notranslate"><span class="pre">/ssi-header?outputType=ssi</span></code>), we’ll get an HTML fragment that includes the static HTML for our page, along with an embedded <code class="docutils literal notranslate"><span class="pre">&lt;style&gt;</span></code> tag, all with absolute-path URLs for links back to the Fusion instance we’re currently running on.</p>
<p>Now in the other application we’re running, it’s simply a matter of fetching content from this <code class="docutils literal notranslate"><span class="pre">/ssi-header?outputType=ssi</span></code> endpoint and rendering the fragment into the server side payload using whatever programming language you deem fit.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="bp.html" class="btn btn-neutral float-right" title="Best Practices" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="local-webpack-states-file.html" class="btn btn-neutral float-left" title="Locally Generated Webpack Stats File" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Guess Me

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>