

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Creating a Web API Returning a Non-HTML Content Type &mdash; Fusion-Doc 1.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Using Service Workers with Fusion" href="service-work.html" />
    <link rel="prev" title="Using Custom Error Pages" href="custom-error-page.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Fusion-Doc
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Components:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="output.html">Creating and Using Output Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="feature.html">Creating a Feature Component</a></li>
<li class="toctree-l1"><a class="reference internal" href="layout.html">Creating a Layout Component</a></li>
<li class="toctree-l1"><a class="reference internal" href="chain.html">Creating a Chain Component</a></li>
<li class="toctree-l1"><a class="reference internal" href="event-handling.html">Event Handling and Interaction</a></li>
</ul>
<p class="caption"><span class="caption-text">Data:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="content-source.html">Defining a Content Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment.html">Using Environment Variables and “Secrets”</a></li>
<li class="toctree-l1"><a class="reference internal" href="consumer-hoc.html">Using the Consumer Higher-Order Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="fetching-content.html">Fetching Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuring-content.html">Dynamically Configuring Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="content-filtering.html">Content Filtering in Fusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="site-properties.html">Using Site Properties</a></li>
</ul>
<p class="caption"><span class="caption-text">General:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Folder.html">Examining the Feature Pack</a></li>
<li class="toctree-l1"><a class="reference internal" href="style.html">Adding Styling to Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom-fields.html">Adding Custom Fields to Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="display-properties.html">Working with Display Properties</a></li>
<li class="toctree-l1"><a class="reference internal" href="isomorphic-server-spa.html">Isomorphic vs. Server vs. SPA rendering</a></li>
<li class="toctree-l1"><a class="reference internal" href="messga-between-components.html">Messaging Between Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom-error-page.html">Using Custom Error Pages</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Creating a Web API Returning a Non-HTML Content Type</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#goals">Goals</a></li>
<li class="toctree-l2"><a class="reference internal" href="#design">Design</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#json-output-type">JSON output type</a></li>
<li class="toctree-l3"><a class="reference internal" href="#xml-output-type">XML output type</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-generic-json-output-type">Creating a generic JSON output type</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-generic-api-layout">Creating a generic api layout</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-chain-to-return-array-type-data">Creating a chain to return array type data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-content-source-to-fetch-section-data">Creating a content source to fetch section data</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-content-source-to-fetch-stories-by-section">Creating a content source to fetch stories by section</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-a-feature-to-combine-section-data-and-stories">Creating a feature to combine section data and stories</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-corresponding-components-for-default-output-for-visual-preview">Creating corresponding components for default output for visual preview</a></li>
<li class="toctree-l2"><a class="reference internal" href="#creating-corresponding-components-for-xml-output-type">Creating corresponding components for XML output type</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="service-work.html">Using Service Workers with Fusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="local-webpack-states-file.html">Locally Generated Webpack Stats File</a></li>
<li class="toctree-l1"><a class="reference internal" href="static-features-outside-of-fusion.html">Including Static Features Outside of Fusion</a></li>
</ul>
<p class="caption"><span class="caption-text">Best Practices:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="bp.html">Best Practices</a></li>
</ul>
<p class="caption"><span class="caption-text">Hooks:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hooks-configuring-content.html">Dynamically Configuring Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="hooks-fetching-content.html">Fetching Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="hooks-event-handling.html">Event Handling and Interaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="hooks.html">React Hooks</a></li>
</ul>
<p class="caption"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api-output.html">Output Type API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-feature.html">Feature API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-layout.html">Layout API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-chain.html">Chain API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-custom-fields.html">Custom Fields API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-consumer.html">Consumer API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-context.html">Context Component API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-content.html">Content Component API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-static.html">Static Component API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-content-source.html">Content Source API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-plugins.html">Plugins API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-local-development-mock.html">Local Mocks API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-site-properties.html">Site Properties API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-fusion-http.html">Fusion HTTP API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Fusion-Doc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Creating a Web API Returning a Non-HTML Content Type</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/return-non-html-content-type.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="creating-a-web-api-returning-a-non-html-content-type">
<h1>Creating a Web API Returning a Non-HTML Content Type<a class="headerlink" href="#creating-a-web-api-returning-a-non-html-content-type" title="Permalink to this headline">¶</a></h1>
<p>Fusion supports non-HTML output types like JSON data and XML. This can be utilized to build web APIs for other usages. Let’s build an API for your mobile applications to get a list of recommended sections by editor’s pick and their most recent stories.</p>
<div class="section" id="goals">
<h2>Goals<a class="headerlink" href="#goals" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li>The mobile API should return a list of sections base on the configuration in PageBuilder Admin.</li>
<li>For each configured section, it should contain the section’s id, name, and x number of most recent stories (x is configurable).</li>
<li>There should be a visual preview for configuring the mobile API in PageBuilder Admin.</li>
</ul>
</div>
<div class="section" id="design">
<h2>Design<a class="headerlink" href="#design" title="Permalink to this headline">¶</a></h2>
<div class="section" id="json-output-type">
<h3>JSON output type<a class="headerlink" href="#json-output-type" title="Permalink to this headline">¶</a></h3>
<p>Building web APIs using JSON output type is similar to building regular web pages. You need to create an output type and features/chains/layouts. The main difference is you don’t create them as React components. All the files must use <code class="docutils literal notranslate"><span class="pre">.js</span></code> file extension, and each rendering method returns a plain JavaScript object. Since usually the payload structure of a web API is either a single object or an array of objects, we can use a single feature to generate the object type payload or a single chain with multiple features to generate the array type payload. This way we can simply create a generic JSON output type and a layout which directly return the first child of the children from the props. Note here, using layout is required due to a known issue in Fusion to receive consistent data structure for the children in JSON output.</p>
<p>This is an entity-relationship diagram for object type payload:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                <span class="o">---------------</span>
                <span class="o">|</span> <span class="n">Output</span> <span class="n">Type</span> <span class="o">|</span>
                <span class="o">---------------</span>
                      <span class="o">|</span>
                      <span class="o">|</span>
                  <span class="o">----------</span>
                  <span class="o">|</span> <span class="n">Layout</span> <span class="o">|</span>
                  <span class="o">----------</span>
                      <span class="o">|</span>  
                      <span class="o">|</span>
                 <span class="o">-----------</span>
                 <span class="o">|</span> <span class="n">Feature</span> <span class="o">|</span>
                 <span class="o">-----------</span>
</pre></div>
</div>
<p>This is an entity-relationship diagram for array type payload:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>                <span class="o">---------------</span>
                <span class="o">|</span> <span class="n">Output</span> <span class="n">Type</span> <span class="o">|</span>
                <span class="o">---------------</span>
                      <span class="o">|</span>
                      <span class="o">|</span>
                  <span class="o">----------</span>
                  <span class="o">|</span> <span class="n">Layout</span> <span class="o">|</span>
                  <span class="o">----------</span>
                      <span class="o">|</span>  
                      <span class="o">|</span>
                  <span class="o">---------</span>
                  <span class="o">|</span> <span class="n">Chain</span> <span class="o">|</span>
                  <span class="o">---------</span>
                      <span class="o">|</span>        
                      <span class="o">|</span>    
                     <span class="o">/|</span>\
                <span class="o">------------</span>  
                <span class="o">|</span> <span class="n">Features</span> <span class="o">|</span>  
                <span class="o">------------</span>
</pre></div>
</div>
<p>For this example, we will use this design approach; however, keep in mind this is not the only way you can use. The real design should reflect to your use cases.</p>
</div>
<div class="section" id="xml-output-type">
<h3>XML output type<a class="headerlink" href="#xml-output-type" title="Permalink to this headline">¶</a></h3>
<p>The above design approach can be applied to none-JSON content types as well. We will build an XML output type as an illustration. The key to achieve this is the output type must return a string as the final result.</p>
</div>
</div>
<div class="section" id="creating-a-generic-json-output-type">
<h2>Creating a generic JSON output type<a class="headerlink" href="#creating-a-generic-json-output-type" title="Permalink to this headline">¶</a></h2>
<p>This generic JSON output type returns the first child in the <code class="docutils literal notranslate"><span class="pre">props.children</span></code> which is the same data returned from a layout.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/* /components/output-types/json.js */

const Json = ({ children }) =&gt; {
  // Only return the data from the first child.
  return Array.isArray(children) ? children[0] : null
}

// Specify content type
Json.contentType = &#39;application/json&#39;

export default Json
</pre></div>
</div>
</div>
<div class="section" id="creating-a-generic-api-layout">
<h2>Creating a generic api layout<a class="headerlink" href="#creating-a-generic-api-layout" title="Permalink to this headline">¶</a></h2>
<p>This generic JSON layout returns the first child in the <code class="docutils literal notranslate"><span class="pre">props.children</span></code> which is the same data returned from the first chain or feature. Since we will create visual preview later, we are using output type naming convention <code class="docutils literal notranslate"><span class="pre">api/json.js</span></code> for different output types.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/* /components/layouts/api/json.js */

const Api = ({ children }) =&gt; {
  // Only return the data from the first child (body)
  return Array.isArray(children) ? children[0] : null
}

Api.sections = [
  &#39;body&#39;
]

export default Api
</pre></div>
</div>
</div>
<div class="section" id="creating-a-chain-to-return-array-type-data">
<h2>Creating a chain to return array type data<a class="headerlink" href="#creating-a-chain-to-return-array-type-data" title="Permalink to this headline">¶</a></h2>
<p>We will create visual preview later, so we are using output type naming convention <code class="docutils literal notranslate"><span class="pre">ApiList/json.js</span></code> for different output types.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/*</span> <span class="o">/</span><span class="n">components</span><span class="o">/</span><span class="n">chains</span><span class="o">/</span><span class="n">ApiList</span><span class="o">/</span><span class="n">json</span><span class="o">.</span><span class="n">js</span> <span class="o">*/</span>

<span class="n">const</span> <span class="n">ApiList</span> <span class="o">=</span> <span class="p">({</span> <span class="n">children</span> <span class="p">})</span> <span class="o">=&gt;</span> <span class="n">children</span>

<span class="n">export</span> <span class="n">default</span> <span class="n">ApiList</span>
</pre></div>
</div>
</div>
<div class="section" id="creating-a-content-source-to-fetch-section-data">
<h2>Creating a content source to fetch section data<a class="headerlink" href="#creating-a-content-source-to-fetch-section-data" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/* /content/sources/section.js */

const resolve = ({
  website,
  id
}) =&gt; `/site/v3/website/${website}/section?_id=${id}`

export default {
  resolve,
  params: [
    {
      name: &#39;website&#39;,
      displayName: &#39;Website&#39;,
      type: &#39;text&#39;
    },
    {
      name: &#39;id&#39;,
      displayName: &#39;Section ID&#39;,
      type: &#39;text&#39;
    }
  ]
}
</pre></div>
</div>
</div>
<div class="section" id="creating-a-content-source-to-fetch-stories-by-section">
<h2>Creating a content source to fetch stories by section<a class="headerlink" href="#creating-a-content-source-to-fetch-stories-by-section" title="Permalink to this headline">¶</a></h2>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/* /content/sources/stories-by-section.js */

const resolve = ({
  website,
  section,
  size = 1,
  offset = 0
}) =&gt; {
  const body = encodeURIComponent(JSON.stringify({
    query: {
      bool: {
        must: [
          {
            term: {
              type: &#39;story&#39;
            }
          },
          {
            nested: {
              path: &#39;taxonomy.sections&#39;,
              query: {
                bool: {
                  must: {
                    term: {
                      &#39;taxonomy.sections._id&#39; : section
                    }
                  }
                }
              }
            }
          }
        ]
      }
    }
  }))
  return `/content/v4/search/published/?website=${website}&amp;body=${body}&amp;size=${size}&amp;from=${offset}&amp;sort=publish_date:desc`
}

export default {
  resolve,
  params: [
    {
      name: &#39;website&#39;,
      displayName: &#39;Website&#39;,
      type: &#39;text&#39;
    },
    {
      name: &#39;section&#39;,
      displayName: &#39;Section ID&#39;,
      type: &#39;text&#39;
    },
    {
      name: &#39;size&#39;,
      displayName: &#39;Site&#39;,
      type: &#39;number&#39;
    },
    {
      name: &#39;offset&#39;,
      displayName: &#39;Offset&#39;,
      type: &#39;number&#39;
    }
  ]
}
</pre></div>
</div>
</div>
<div class="section" id="creating-a-feature-to-combine-section-data-and-stories">
<h2>Creating a feature to combine section data and stories<a class="headerlink" href="#creating-a-feature-to-combine-section-data-and-stories" title="Permalink to this headline">¶</a></h2>
<p>In this feature, we need to fetch both section and stories data using the content sources we created above and return the desired data structure. Since we will create visual preview later, we are using output type naming convention <code class="docutils literal notranslate"><span class="pre">Section/json.js</span></code> for different output types.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/* /components/features/api/Section/json.js */

import PropTypes from &#39;prop-types&#39;
import Consumer from &#39;fusion:consumer&#39;

const WEBSITE_ID = &#39;your_website_id&#39;

@Consumer
class Section {
  constructor (props) {
    this.props = props
    const {
      customFields: {
        section,
        size = 3
      } = {}
    } = props

    this.fetchContent({
      section: {
        source: &#39;section&#39;,
        query: {
          website: WEBSITE_ID,
          id: section
        }
      },
      result: {
        source: &#39;stories-by-section&#39;,
        query: {
          website: WEBSITE_ID,
          section,
          size
        }
      }
    })
  }

  render () {
    const {
      section,
      result
    } = this.state || {}

    if (!section || !result) {
      return null
    }

    return {
      id: section._id,
      name: section.name,
      stories: result.content_elements
    }
  }
}

Section.propTypes = {
  customFields: PropTypes.shape({
    section: PropTypes.string.tag({
      label: &#39;Section ID&#39;
    }).isRequired,
    size: PropTypes.number.tag({
      label: &#39;# of Stories&#39;,
      defaultValue: 3
    })
  })
}

export default Section
</pre></div>
</div>
</div>
<div class="section" id="creating-corresponding-components-for-default-output-for-visual-preview">
<h2>Creating corresponding components for default output for visual preview<a class="headerlink" href="#creating-corresponding-components-for-default-output-for-visual-preview" title="Permalink to this headline">¶</a></h2>
<p>With all the components created above, you should be able to build the mobile API in PageBuilder Admin as a page to serve recommended sections and their stories using <code class="docutils literal notranslate"><span class="pre">outputType=json</span></code>. However the editing process might not be convenient as it’s just a bunch of JSON data if using JSON output for preview.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/* /components/layouts/api/default.jsx */

import React from &#39;react&#39;
import PropTypes from &#39;prop-types&#39;

const Api = ({ children }) =&gt; {
  return (
    &lt;&gt;
      {children}
    &lt;/&gt;
  )
}

Api.sections = [
  &#39;body&#39;
]

Api.propTypes = {
  children: PropTypes.array
}

export default Api


/* /components/chains/ApiList/default.jsx */

import React from &#39;react&#39;
import PropTypes from &#39;prop-types&#39;

const ApiList = ({ children }) =&gt; &lt;div&gt;{children}&lt;/div&gt;

ApiList.propTypes = {
  children: PropTypes.any
}

export default ApiList


/* /components/features/api/Section/default.jsx */

import React, { Component } from &#39;react&#39;
import PropTypes from &#39;prop-types&#39;
import Consumer from &#39;fusion:consumer&#39;

const WEBSITE_ID = &#39;your_website_id&#39;

@Consumer
class Section extends Component {
  constructor (props) {
    super(props)
    const {
      customFields: {
        section,
        size = 3
      } = {}
    } = props

    this.fetchContent({
      section: {
        source: &#39;section&#39;,
        query: {
          website: WEBSITE_ID,
          id: section
        }
      },
      result: {
        source: &#39;stories-by-section&#39;,
        query: {
          website: WEBSITE_ID,
          section,
          size
        }
      }
    })
  }

  render () {
    const {
      section,
      result
    } = this.state || {}

    if (!section || !result) {
      return null
    }

    const stories = result.content_elements || []

    return (
      &lt;div&gt;
        &lt;h3&gt;Section {section.name} ({section._id})&lt;/h3&gt;
        &lt;ol&gt;
          {
            stories.map((story) =&gt; (
              &lt;li key={story._id}&gt;{story.headlines.basic}&lt;/li&gt;
            ))
          }
        &lt;/ol&gt;
      &lt;/div&gt;
    )
  }
}

Section.propTypes = {
  customFields: PropTypes.shape({
    section: PropTypes.string.tag({
      label: &#39;Section ID&#39;
    }).isRequired,
    size: PropTypes.number.tag({
      label: &#39;# of Stories&#39;,
      defaultValue: 3
    })
  })
}

export default Section
</pre></div>
</div>
<p>Now check the page you created earlier in PageBuilder Admin, you should be able to see the visual presentation for each section and click through for modification.</p>
</div>
<div class="section" id="creating-corresponding-components-for-xml-output-type">
<h2>Creating corresponding components for XML output type<a class="headerlink" href="#creating-corresponding-components-for-xml-output-type" title="Permalink to this headline">¶</a></h2>
<p>Since we need to return a string for the XML output type, we will use the <a class="reference external" href="https://www.npmjs.com/package/xmlbuilder">xmlbuilder npm module</a> to build the DOM tree from a plain JavaScript object and convert it to an XML string. To simply the object conversion, the feature, chain, and layout should return objects using the <a class="reference external" href="https://github.com/oozcitak/xmlbuilder-js/wiki/Conversion-From-Object">structure</a>. You can also use other XML builders if you have a different preference.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/* /components/output-types/xml.js */

import xmlbuilder from &#39;xmlbuilder&#39;

const Xml = ({ children }) =&gt; {
  // Only return the data from the first child.
  console.log(children[0])
  return xmlbuilder.create({
    service: children[0] || &#39;&#39;
  }, {
    separateArrayItems: true
  }).end({
    pretty: true
  })
}

// XML content type
Xml.contentType = &#39;application/xml&#39;

export default Xml


/* /components/layouts/api/xml.jsx */

const Api = ({ children }) =&gt; {
  // Only return the data from the first child (body)
  return Array.isArray(children) ? children[0] : null
}

Api.sections = [
  &#39;body&#39;
]

export default Api


/* /components/chains/ApiList/xml.jsx */

const ApiList = ({ children }) =&gt; {
  // Remove null results
  return children.filter((child) =&gt; !!child)
}

export default ApiList


/* /components/features/api/Section/xml.jsx */

import PropTypes from &#39;prop-types&#39;
import Consumer from &#39;fusion:consumer&#39;
import get from &#39;lodash.get&#39;

const WEBSITE_ID = &#39;your_website_id&#39;

@Consumer
class Section {
  constructor (props) {
    this.props = props
    const {
      customFields: {
        section,
        size = 3
      } = {}
    } = props

    this.fetchContent({
      section: {
        source: &#39;section&#39;,
        query: {
          website: WEBSITE_ID,
          id: section
        }
      },
      result: {
        source: &#39;stories-by-section&#39;,
        query: {
          website: WEBSITE_ID,
          section,
          size
        }
      }
    })
  }

  render () {
    const {
      section,
      result
    } = this.state || {}

    if (!section || !result) {
      return null
    }

    // For the example, we will only include id, headline, and description for each story
    return {
      section: {
        id: section._id,
        name: section.name,
        stories: result.content_elements.map((story) =&gt; ({
          story: {
            id: story._id,
            headline: get(story, &#39;headlines.basic&#39;, &#39;&#39;),
            description: get(story, &#39;description.basic&#39;, &#39;&#39;)
          }
        }))
      }
    }
  }
}

Section.propTypes = {
  customFields: PropTypes.shape({
    section: PropTypes.string.tag({
      label: &#39;Section ID&#39;
    }).isRequired,
    size: PropTypes.number.tag({
      label: &#39;# of Stories&#39;,
      defaultValue: 3
    })
  })
}

export default Section
</pre></div>
</div>
<p>After you create all these components, you can use <code class="docutils literal notranslate"><span class="pre">outputType=xml</span></code> to view the XML payload.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="service-work.html" class="btn btn-neutral float-right" title="Using Service Workers with Fusion" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="custom-error-page.html" class="btn btn-neutral float-left" title="Using Custom Error Pages" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Guess Me

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>