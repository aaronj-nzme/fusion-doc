

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Messaging Between Components &mdash; Fusion-Doc 1.0.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Using Custom Error Pages" href="custom-error-page.html" />
    <link rel="prev" title="Isomorphic vs. Server vs. SPA rendering" href="isomorphic-server-spa.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> Fusion-Doc
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Components:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="output.html">Creating and Using Output Types</a></li>
<li class="toctree-l1"><a class="reference internal" href="feature.html">Creating a Feature Component</a></li>
<li class="toctree-l1"><a class="reference internal" href="layout.html">Creating a Layout Component</a></li>
<li class="toctree-l1"><a class="reference internal" href="chain.html">Creating a Chain Component</a></li>
<li class="toctree-l1"><a class="reference internal" href="event-handling.html">Event Handling and Interaction</a></li>
</ul>
<p class="caption"><span class="caption-text">Data:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="content-source.html">Defining a Content Source</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment.html">Using Environment Variables and “Secrets”</a></li>
<li class="toctree-l1"><a class="reference internal" href="consumer-hoc.html">Using the Consumer Higher-Order Function</a></li>
<li class="toctree-l1"><a class="reference internal" href="fetching-content.html">Fetching Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuring-content.html">Dynamically Configuring Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="content-filtering.html">Content Filtering in Fusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="site-properties.html">Using Site Properties</a></li>
</ul>
<p class="caption"><span class="caption-text">General:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="Folder.html">Examining the Feature Pack</a></li>
<li class="toctree-l1"><a class="reference internal" href="style.html">Adding Styling to Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom-fields.html">Adding Custom Fields to Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="display-properties.html">Working with Display Properties</a></li>
<li class="toctree-l1"><a class="reference internal" href="isomorphic-server-spa.html">Isomorphic vs. Server vs. SPA rendering</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Messaging Between Components</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#the-problem-with-state">The problem with state</a></li>
<li class="toctree-l2"><a class="reference internal" href="#how-to-message">How to message</a></li>
<li class="toctree-l2"><a class="reference internal" href="#removing-listeners">Removing listeners</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="custom-error-page.html">Using Custom Error Pages</a></li>
<li class="toctree-l1"><a class="reference internal" href="return-non-html-content-type.html">Creating a Web API Returning a Non-HTML Content Type</a></li>
<li class="toctree-l1"><a class="reference internal" href="service-work.html">Using Service Workers with Fusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="local-webpack-states-file.html">Locally Generated Webpack Stats File</a></li>
<li class="toctree-l1"><a class="reference internal" href="static-features-outside-of-fusion.html">Including Static Features Outside of Fusion</a></li>
</ul>
<p class="caption"><span class="caption-text">Best Practices:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="bp.html">Best Practices</a></li>
</ul>
<p class="caption"><span class="caption-text">Hooks:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="hooks-configuring-content.html">Dynamically Configuring Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="hooks-fetching-content.html">Fetching Content</a></li>
<li class="toctree-l1"><a class="reference internal" href="hooks-event-handling.html">Event Handling and Interaction</a></li>
<li class="toctree-l1"><a class="reference internal" href="hooks.html">React Hooks</a></li>
</ul>
<p class="caption"><span class="caption-text">API:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="api-output.html">Output Type API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-feature.html">Feature API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-layout.html">Layout API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-chain.html">Chain API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-custom-fields.html">Custom Fields API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-consumer.html">Consumer API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-context.html">Context Component API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-content.html">Content Component API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-static.html">Static Component API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-content-source.html">Content Source API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-plugins.html">Plugins API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-local-development-mock.html">Local Mocks API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-site-properties.html">Site Properties API</a></li>
<li class="toctree-l1"><a class="reference internal" href="api-fusion-http.html">Fusion HTTP API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">Fusion-Doc</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Messaging Between Components</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/messga-between-components.md.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="messaging-between-components">
<h1>Messaging Between Components<a class="headerlink" href="#messaging-between-components" title="Permalink to this headline">¶</a></h1>
<p>In any software application of sufficient size and complexity, you’ll have to deal with <a class="reference external" href="https://en.wikipedia.org/wiki/State_(computer_science)#Program_state">state management</a> - the <code class="docutils literal notranslate"><span class="pre">get</span></code>ting and <code class="docutils literal notranslate"><span class="pre">set</span></code>ting of common data between disparate components. Fusion applications are no different - but they do come with an interesting set of challenges.</p>
<div class="section" id="the-problem-with-state">
<h2>The problem with state<a class="headerlink" href="#the-problem-with-state" title="Permalink to this headline">¶</a></h2>
<p>In a typical web application using React, sharing state between components would be solved by either <a class="reference external" href="https://reactjs.org/docs/lifting-state-up.html">lifting state up</a> to a common ancestor, or in more complicated scenarios by some sort of state management library like <a class="reference external" href="https://redux.js.org/">Redux</a>, <a class="reference external" href="https://mobx.js.org/">Mobx</a> or others.</p>
<p>But Fusion applications are <em>not</em> typical web applications. The chief difference (and difficulty) in building Fusion apps vs. typical web apps is that <strong>Fusion does not know which components will be on the page at build time</strong>. Because PageBuilder editors are the ones who control which components go on which pages/templates, Feature Pack developers can’t be sure which components will coexist when they are writing those components. As a result, state management between components becomes difficult, since we can’t reliably depend on any other components to exist on the page!</p>
<p>Because of this, it’s considered a Fusion “best practice” to try and write your components in such a way that they are totally self-sufficient and don’t depend on the existence or non-existence of any other components on your webpage.</p>
<p>However, because we live in a flawed world, sometimes it will become necessary for two components to share small amounts of information between one another. Fusion offers a dead-simple messaging mechanism for one component on the page to notify another (or several others) that a change has occurred.</p>
</div>
<div class="section" id="how-to-message">
<h2>How to message<a class="headerlink" href="#how-to-message" title="Permalink to this headline">¶</a></h2>
<p>Let’s say we have an urgent need for our movie summary application: users are telling us that when they’re reading the plot of a movie, it’s distracting to see a list of so many other great movies in the sidebar. So we want to hide the list of movies when the plot of a movie is shown, and display it only when the plot is hidden. The only problem: the <code class="docutils literal notranslate"><span class="pre">MovieList</span></code> lives in a different component than the <code class="docutils literal notranslate"><span class="pre">MovieDetail</span></code>, which is where we toggle the plot to be hidden or shown! Does this sound like a use case contrived to prove a point? You betcha!</p>
<p>The <code class="docutils literal notranslate"><span class="pre">Consumer</span></code> provides two simple utility methods to help us send and receive messages between components: <code class="docutils literal notranslate"><span class="pre">dispatchEvent</span></code> and <code class="docutils literal notranslate"><span class="pre">addEventListener</span></code>. These methods mimic the methods of the same name that are included on browser DOM nodes; the difference is that these methods are invoked on React components wrapped by the <code class="docutils literal notranslate"><span class="pre">Consumer</span></code>, not DOM nodes.</p>
<p>The first thing we’ll want to do is to dispatch an event from our <code class="docutils literal notranslate"><span class="pre">MovieDetail</span></code> component whenever the plot of our movie is hidden or shown. That’s easy enough, we’ll just add a couple lines to the <code class="docutils literal notranslate"><span class="pre">togglePlot</span></code> method in our component:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/*  /components/features/movies/movie-detail.jsx  */

@Consumer
class MovieDetail extends Component {
  ...
  togglePlot () {
    const { isPlotShown } = this.state
    // Create a common const `newPlotShown` for the next 2 lines to use
    const newPlotShown = !isPlotShown
    this.setState({ isPlotShown: newPlotShown })

    // Dispatch an event called `moviePlotToggled` whose value is the new state of the plot&#39;s visibility
    this.dispatchEvent(&#39;moviePlotToggled&#39;, newPlotShown)
  }
  ...
}

export default MovieDetail
</pre></div>
</div>
<p>As you can see, we can use the <code class="docutils literal notranslate"><span class="pre">dispatchEvent</span></code> method just like we would on a DOM node to notify any subscribers to the <code class="docutils literal notranslate"><span class="pre">moviePlotToggled</span></code> event what state the movie plot’s visibility is in.</p>
<p>Now, we have to listen for that change in our <code class="docutils literal notranslate"><span class="pre">MovieList</span></code> component:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/*  /components/features/movies/movie-list.jsx  */

@Consumer
class MovieList extends Component {
  constructor (props) {
    super(props)
    // Adding the `showList: true` property
    this.state = { movies: [], page: 1, showList: true }
    this.fetch = this.fetch.bind(this)
    this.fetch();
  }

  ...

  // Adding our eventListener inside `componentDidMount` ensures it only happens client-side
  componentDidMount () {
    // Define an event handler that sets the `showList` property to the opposite of the `plotShown` value we receive
    const msgHandler = (plotShown) =&gt; {
      this.setState({ showList: !plotShown })
    }
    // Trigger the event handler when the `moviePlotToggled` event is triggered
    this.addEventListener(&#39;moviePlotToggled&#39;, msgHandler)
  }

  ...

  render () {
    const { movies, showList } = this.state
    // Use the `showList` state to determine whether to show the movie list or not
    return showList ? (
      &lt;Fragment&gt;
        ...
      &lt;/Fragment&gt;
    ) : null
  }
}

export default MovieList
</pre></div>
</div>
<p>Let’s walk through it:</p>
<ul class="simple">
<li>In order to determine whether or not we should show the <code class="docutils literal notranslate"><span class="pre">MovieList</span></code> or not, we add a <code class="docutils literal notranslate"><span class="pre">showList</span></code> property to our component state that will track whether it should be displayed.</li>
<li>Inside a <code class="docutils literal notranslate"><span class="pre">componentDidMount</span></code> lifecycle hook, we invoke our <code class="docutils literal notranslate"><span class="pre">addEventListener</span></code> method and pass it the name of the event we’re listening for, and a handler for when the event is triggered.</li>
<li>The handler method receives an argument representing the event payload, which in this case is a boolean of whether or not the plot is shown. If the plot is shown we want to hide the movie list, and vice versa.</li>
<li>In our render method, we use the <code class="docutils literal notranslate"><span class="pre">showList</span></code> property that we toggled in our event handler to determine whether or not to display the movie list.</li>
</ul>
<p>The effect of this code should be that when the <code class="docutils literal notranslate"><span class="pre">moviePlotToggled</span></code> event is dispatched in the <code class="docutils literal notranslate"><span class="pre">MovieDetail</span></code> component, our <code class="docutils literal notranslate"><span class="pre">MovieList</span></code> component will listen to that change and toggle its display to be the opposite of whatever the movie plot’s state is! Our users can now read the plots of their movies without distraction.</p>
<p>There’s no reason we couldn’t have several other components listening to this same event if we needed to; this makes the simple messaging API provided by Fusion very flexible.</p>
</div>
<div class="section" id="removing-listeners">
<h2>Removing listeners<a class="headerlink" href="#removing-listeners" title="Permalink to this headline">¶</a></h2>
<p>In addition to dispatching events and listening to them, Fusion offers a way to remove listeners as needed. This is not only a good way to prevent multiple triggers of an event handler (if desired); it’s also good practice to remove listeners from the page once they (or their parent components) aren’t needed anymore, to prevent phantom listeners from <a class="reference external" href="http://crockford.com/javascript/memory/leak.html">causing memory leaks</a>.</p>
<p>Let’s say in this instance we only want to toggle the MovieList component one time and never again; we can simply add a <code class="docutils literal notranslate"><span class="pre">removeEventListener</span></code> method invocation inside our event handler.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>/*  /components/features/movies/movie-list.jsx  */

@Consumer
class MovieList extends Component {
  ...
  componentDidMount () {
    const msgHandler = (plotShown) =&gt; {
      this.setState({ showList: !plotShown })
      // Remove the `msgHandler` event handler function (which is the parent function of this block) as a subscriber from the &#39;moviePlotToggled&#39; event
      this.removeEventListener(&#39;moviePlotToggled&#39;, msgHandler)
    }

    this.addEventListener(&#39;moviePlotToggled&#39;, msgHandler)
  }
  ...
}

export default MovieList
</pre></div>
</div>
<p>In the simple example above, we remove the <code class="docutils literal notranslate"><span class="pre">msgHandler</span></code> event handler inside of itself. This will have the effect of the handler being removed after it is invoked the very first time, meaning in our case that the first time a user clicks “Show Plot” the <code class="docutils literal notranslate"><span class="pre">MovieList</span></code> will go away and not come back until the page is refreshed. It’s important that the 2nd argument to <code class="docutils literal notranslate"><span class="pre">removeEventListener</span></code> is a reference to the <em>exact same</em> function instance that was passed to the <code class="docutils literal notranslate"><span class="pre">addEventListener</span></code> method.</p>
<p>A more common use of <code class="docutils literal notranslate"><span class="pre">removeEventListener</span></code> might be to remove any listeners from the component inside a <code class="docutils literal notranslate"><span class="pre">componentWillUnmount</span></code> lifecycle method. This should work fine, as long as the event handling functions are made instance methods of the component so they can be referenced in both the <code class="docutils literal notranslate"><span class="pre">addEventListener</span></code> and <code class="docutils literal notranslate"><span class="pre">removeEventListener</span></code> calls.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="custom-error-page.html" class="btn btn-neutral float-right" title="Using Custom Error Pages" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="isomorphic-server-spa.html" class="btn btn-neutral float-left" title="Isomorphic vs. Server vs. SPA rendering" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Guess Me

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>